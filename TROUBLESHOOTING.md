# Troubleshooting Guide

## Timeout Error: "Timeout waiting for Datecs response"

### –°–∏–º–ø—Ç–æ–º
```
Datecs command failed: Timeout waiting for Datecs response after 5s
```

### –ü—Ä–∏—á–∏–Ω–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

#### 1. –ü—Ä–∏–Ω—Ç–µ—Ä—ä—Ç –Ω–µ –µ –≤–∫–ª—é—á–µ–Ω
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –í–∏–∂ –¥–∞–ª–∏ –ø—Ä–∏–Ω—Ç–µ—Ä—ä—Ç –∏–º–∞ –∑–∞—Ö—Ä–∞–Ω–≤–∞–Ω–µ –∏ –∑–µ–ª–µ–Ω–∞—Ç–∞ LED —Å–≤–µ—Ç–ª–∏–Ω–∞ —Å–≤–µ—Ç–∏.
**–†–µ—à–µ–Ω–∏–µ:** –í–∫–ª—é—á–∏ –ø—Ä–∏–Ω—Ç–µ—Ä–∞ –∏ –∏–∑—á–∞–∫–∞–π –¥–∞ –ø—Ä–∏–∫–ª—é—á–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è—Ç–∞ (–æ–∫–æ–ª–æ 5-10 —Å–µ–∫—É–Ω–¥–∏).

#### 2. –ì—Ä–µ—à–µ–Ω COM –ø–æ—Ä—Ç
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** 
- Windows Device Manager ‚Üí Ports (COM & LPT) ‚Üí –ü—Ä–æ–≤–µ—Ä–∏ –∫–æ–π –µ —Ç–æ—á–Ω–∏—è –ø–æ—Ä—Ç
- –ò–ª–∏ –∏–∑–ø–æ–ª–∑–≤–∞–π "üîÑ –¢—ä—Ä—Å–∏ –ø—Ä–∏–Ω—Ç–µ—Ä–∏" –≤ Printers —Ç–∞–±

**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª–Ω–∏—è COM –ø–æ—Ä—Ç –æ—Ç dropdown-–∞.

#### 3. –ì—Ä–µ—à–µ–Ω baudrate
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** Datecs –ø—Ä–∏–Ω—Ç–µ—Ä–∏—Ç–µ –ø–æ–¥–¥—ä—Ä–∂–∞—Ç: 1200, 2400, 4800, 9600, 19200, 38400, 57600, 115200 bps

**–†–µ—à–µ–Ω–∏–µ:** 
- **FP-700MX/FP-700X Series:** –û–±–∏–∫–Ω–æ–≤–µ–Ω–æ 115200 (–ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ)
- **FP-2000 Series:** –û–±–∏–∫–Ω–æ–≤–µ–Ω–æ 115200, –Ω–æ –º–æ–∂–µ –¥–∞ –µ –ø—Ä–æ–º–µ–Ω–µ–Ω
- **–ê–∫–æ –Ω–µ —Å–∏ —Å–∏–≥—É—Ä–µ–Ω:** –û–ø–∏—Ç–∞–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–Ω–æ: 115200 ‚Üí 9600 ‚Üí 19200 ‚Üí 38400 ‚Üí 57600

#### 4. –ö–∞–±–µ–ª—ä—Ç –Ω–µ –µ —Å–≤—ä—Ä–∑–∞–Ω –∏–ª–∏ –µ –ø–æ–≤—Ä–µ–¥–µ–Ω
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** 
- –ü—Ä–æ–≤–µ—Ä–∏ USB-to-Serial –∏–ª–∏ RS232 –∫–∞–±–µ–ª–∞
- –û–ø–∏—Ç–∞–π –¥—Ä—É–≥ USB –ø–æ—Ä—Ç
- –û–ø–∏—Ç–∞–π –¥–∞ —Ä–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞—à –ø—Ä–∏–Ω—Ç–µ—Ä–∞

#### 5. –î—Ä—É–≥–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –∏–∑–ø–æ–ª–∑–≤–∞ –ø–æ—Ä—Ç–∞
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** Device Manager ‚Üí Properties –Ω–∞ COM –ø–æ—Ä—Ç–∞ ‚Üí "Port is open by another application"

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞—Ç–≤–æ—Ä–∏ –≤—Å–∏—á–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–∏ –∫–æ–∏—Ç–æ –º–æ–≥–∞—Ç –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞—Ç –ø—Ä–∏–Ω—Ç–µ—Ä–∞ (–¥—Ä—É–≥–∏ fiscal software, terminal programs, etc.)

#### 6. –î—Ä–∞–π–≤–µ—Ä–∏ –∑–∞ USB-to-Serial
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** Device Manager ‚Üí –ò–º–∞ –ª–∏ –∂—ä–ª—Ç ! –∑–Ω–∞–∫ –Ω–∞ COM –ø–æ—Ä—Ç–∞?

**–†–µ—à–µ–Ω–∏–µ:** 
- –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π –∞–∫—Ç—É–∞–ª–Ω–∏ –¥—Ä–∞–π–≤–µ—Ä–∏ –∑–∞ —Ç–≤–æ—è USB-to-Serial –∞–¥–∞–ø—Ç–µ—Ä
- –ó–∞ FTDI —á–∏–ø–æ–≤–µ: https://ftdichip.com/drivers/
- –ó–∞ Prolific —á–∏–ø–æ–≤–µ: http://www.prolific.com.tw/

#### 7. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–∏ switches –Ω–∞ –ø—Ä–∏–Ω—Ç–µ—Ä–∞
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–∏–Ω—Ç–µ—Ä—ä—Ç –º–æ–∂–µ –¥–∞ –∏–º–∞ —Ä–∞–∑–ª–∏—á–µ–Ω baudrate –æ—Ç –æ—á–∞–∫–≤–∞–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:** 
- FP-700 Series: Command 41 (29H) –∑–∞ —á–µ—Ç–µ–Ω–µ –Ω–∞ switches
- FP-2000 Series: Command 41 (29H) –∑–∞ —á–µ—Ç–µ–Ω–µ –Ω–∞ switches
- Switches 6,7,8 –æ–ø—Ä–µ–¥–µ–ª—è—Ç baudrate

---

## –ì—Ä–µ—à–∫–∞: "printer_type A/C"

### ‚ö†Ô∏è –í–ê–ñ–ù–û
**`printer_type` –ù–ï –°–ï –ò–ó–ü–û–õ–ó–í–ê –≤ raw protocol —Ä–µ–∂–∏–º!**

- `printer_type` –µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–µ–Ω **–°–ê–ú–û –∑–∞ SDK —Ä–µ–∂–∏–º** (FiscalPrinterSDK.dll)
- –í raw protocol —Ä–µ–∂–∏–º (–∫–æ–π—Ç–æ –∏–∑–ø–æ–ª–∑–≤–∞–º–µ —Å–µ–≥–∞), —Ç–æ–≤–∞ –ø–æ–ª–µ –µ **–∏–≥–Ω–æ—Ä–∏—Ä–∞–Ω–æ**
- **–ü—Ä–µ–º–∞—Ö–Ω–∞—Ö–º–µ –≥–æ –æ—Ç UI** –∑–∞ –¥–∞ –∏–∑–±–µ–≥–Ω–µ–º –æ–±—ä—Ä–∫–≤–∞–Ω–µ

### –ê–∫–æ –∏–∑–ø–æ–ª–∑–≤–∞—à SDK —Ä–µ–∂–∏–º:
```json
{
  "protocol": "sdk",
  "sdk": {
    "printer_type": "A",  // ‚Üê –¢—É–∫ "A" –∏–ª–∏ "C" —Å–∞ –≤–∞–ª–∏–¥–Ω–∏
    "connection_type": "COM",
    "ip_address_or_usb_port": "COM3",
    "port_or_baud_rate": 115200
  }
}
```

### –í raw protocol —Ä–µ–∂–∏–º (—Å–µ–≥–∞—à–µ–Ω):
```json
{
  "protocol": "raw"
  // printer_type –ù–ï –µ –Ω—É–∂–µ–Ω
}
```

---

## –¢–µ—Å—Ç–≤–∞–Ω–µ –Ω–∞ –≤—Ä—ä–∑–∫–∞—Ç–∞

### –†—ä—á–µ–Ω —Ç–µ—Å—Ç —Å serial terminal
1. –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π Putty –∏–ª–∏ RealTerm
2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–π:
   - Serial port: COM5 (–Ω–∞–ø—Ä–∏–º–µ—Ä)
   - Speed: 115200
   - Data bits: 8
   - Parity: None
   - Stop bits: 1
3. –û—Ç–≤–æ—Ä–∏ –≤—Ä—ä–∑–∫–∞—Ç–∞
4. –ò–∑–ø—Ä–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∞ (hex): `01 2C 20 4A 30 05 30 30 37 3D 03`
   - –¢–æ–≤–∞ –µ CMD_STATUS (74/0x4A)
5. –¢—Ä—è–±–≤–∞ –¥–∞ –ø–æ–ª—É—á–∏—à –æ—Ç–≥–æ–≤–æ—Ä –∑–∞–ø–æ—á–≤–∞—â —Å `01`

### –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ built-in Status Check
1. –û—Ç–∏–¥–∏ –≤ Printers —Ç–∞–±
2. –î–æ–±–∞–≤–∏ –ø—Ä–∏–Ω—Ç–µ—Ä–∞ (–¥–æ—Ä–∏ —Å –≥—Ä–µ—à–Ω–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
3. –ü–æ–≥–ª–µ–¥–Ω–∏ header-–∞ ‚Üí –ê–∫–æ –∏–º–∞ ‚ö†Ô∏è –≥—Ä–µ—à–∫–∞, –≤–∏–∂–¥–∞—à –¥–µ—Ç–∞–π–ª–∏
4. –ü—Ä–æ–º–µ–Ω—è–π baudrate –¥–æ–∫–∞—Ç–æ –≥—Ä–µ—à–∫–∞—Ç–∞ –∏–∑—á–µ–∑–Ω–µ

---

## Timeout –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ
- **Serial timeout:** 5000ms (5 —Å–µ–∫—É–Ω–¥–∏)
- **Command retry:** 2 –æ–ø–∏—Ç–∞
- **Protocol timeout:** 500ms –º–µ–∂–¥—É –æ–ø–∏—Ç–∏

### –£–≤–µ–ª–∏—á–∞–≤–∞–Ω–µ –Ω–∞ timeout (–∑–∞ –±–∞–≤–Ω–∏ –ø—Ä–∏–Ω—Ç–µ—Ä–∏)
–ù–µ –º–æ–∂–µ—à –¥–∞ –ø—Ä–æ–º–µ–Ω—è—à timeout –æ—Ç UI, –Ω–æ –º–æ–∂–µ—à –¥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–∞—à –ø—Ä–∏–Ω—Ç–µ—Ä–∞ –≤ –ë–î:

```sql
UPDATE printers 
SET baudrate = 115200,
    config = json_set(config, '$.timeout_ms', 10000)
WHERE id = 1;
```

---

## –ß–µ—Å—Ç–∏ –≥—Ä–µ—à–∫–∏

### "Command not allowed"
**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–∏–Ω—Ç–µ—Ä—ä—Ç –µ –≤ –Ω–µ–≤–∞–ª–∏–¥–µ–Ω —Ä–µ–∂–∏–º (–Ω–∞–ø—Ä. –æ—Ç–≤–æ—Ä–µ–Ω –±–æ–Ω)

**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–ø–æ–ª–∑–≤–∞–π "‚ö†Ô∏è –û—Ç–∫–∞–∑ –Ω–∞ –±–æ–Ω" –≤ Fiscal —Ç–∞–±

### "No paper"
**–ü—Ä–∏—á–∏–Ω–∞:** –ù—è–º–∞ —Ö–∞—Ä—Ç–∏—è –∏–ª–∏ —Å–µ–Ω–∑–æ—Ä—ä—Ç –Ω–µ —è –≤–∏–∂–¥–∞

**–†–µ—à–µ–Ω–∏–µ:** 
1. –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ —Ö–∞—Ä—Ç–∏—è—Ç–∞ –µ –ø–æ—Å—Ç–∞–≤–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª–Ω–æ
2. –ó–∞—Ç–≤–æ—Ä–∏ –∫–∞–ø–∞–∫–∞ –Ω–∞–ø—ä–ª–Ω–æ
3. –ü–æ—á–∏—Å—Ç–∏ —Å–µ–Ω–∑–æ—Ä–∞ –∑–∞ —Ö–∞—Ä—Ç–∏—è

### "Cover open"
**–ü—Ä–∏—á–∏–Ω–∞:** –ö–∞–ø–∞–∫—ä—Ç –µ –æ—Ç–≤–æ—Ä–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞—Ç–≤–æ—Ä–∏ –∫–∞–ø–∞–∫–∞ –¥–æ–∫–∞—Ç–æ —â—Ä–∞–∫–Ω–µ

### "Fiscal memory full"
**–ü—Ä–∏—á–∏–Ω–∞:** –§–∏—Å–∫–∞–ª–Ω–∞—Ç–∞ –ø–∞–º–µ—Ç –µ –ø—ä–ª–Ω–∞ (1825 –∏–ª–∏ 3650 Z-—Ä–∞–ø–æ—Ä—Ç–∞)

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∏–Ω—Ç–µ—Ä—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ –∑–∞–º–µ–Ω–µ–Ω –∏–ª–∏ —Å–µ—Ä–≤–∏–∑–∏—Ä–∞–Ω –æ—Ç BIM —É–ø—ä–ª–Ω–æ–º–æ—â–µ–Ω —Å–µ—Ä–≤–∏–∑

---

## Logging –∑–∞ –¥–µ–±—ä–≥–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∏ backend logs
```bash
# Windows
Get-Content data\print_gateway.log -Tail 100

# –°–ª–µ–¥ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –≤–∏–∂–¥–∞—à:
[2026-02-04 01:34:40] INFO DATECS_SEND ...
[2026-02-04 01:34:41] ERROR DATECS_PROTOCOL_ERROR ...
```

### –í–∞–∂–Ω–∏ –ª–æ–≥ —Å—ä–æ–±—â–µ–Ω–∏—è
- `DATECS_SEND` - –ò–∑–ø—Ä–∞—Ç–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞
- `DATECS_RECV` - –ü–æ–ª—É—á–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä
- `DATECS_PROTOCOL_ERROR` - –ü—Ä–æ—Ç–æ–∫–æ–ª–Ω–∞ –≥—Ä–µ—à–∫–∞
- `DATECS_FISCAL_ERROR` - –§–∏—Å–∫–∞–ª–Ω–∞ –≥—Ä–µ—à–∫–∞ –æ—Ç –ø—Ä–∏–Ω—Ç–µ—Ä–∞
- `SERIAL_TIMEOUT` - Timeout –Ω–∞ serial –ø–æ—Ä—Ç–∞

---

## –ö–æ–Ω—Ç–∞–∫—Ç–∏ –∑–∞ –ø–æ–¥–¥—Ä—ä–∂–∫–∞

–ü—Ä–∏ —Ö–∞—Ä–¥—É–µ—Ä–Ω–∏ –ø—Ä–æ–±–ª–µ–º–∏ —Å –ø—Ä–∏–Ω—Ç–µ—Ä–∞ —Å–µ —Å–≤—ä—Ä–∂–∏ —Å:
- **Datecs Bulgaria:** https://datecs.bg
- **BIM —Å–µ—Ä–≤–∏–∑–Ω–∏ —Ü–µ–Ω—Ç—Ä–æ–≤–µ** –∑–∞ —Ñ–∏—Å–∫–∞–ª–Ω–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

–ü—Ä–∏ —Å–æ—Ñ—Ç—É–µ—Ä–Ω–∏ –ø—Ä–æ–±–ª–µ–º–∏ —Å FiscalAPI:
- –ü—Ä–æ–≤–µ—Ä–∏ `data/print_gateway.log`
- –ü—Ä–æ–≤–µ—Ä–∏ `ARCHITECTURE.md` –∑–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –¥–µ—Ç–∞–π–ª–∏
- –ü—Ä–æ–≤–µ—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏—Ç–µ –≤ `data/print_gateway.sqlite`
